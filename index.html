<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>商品一覧 | まるはし</title>
  <meta name="description" content="各商品の決済リンク（Stripe Payment Links）を右側に常時表示します。" />
  <meta name="robots" content="index,follow" />
  <meta property="og:title" content="商品一覧 | まるはし" />
  <meta property="og:description" content="各商品の決済リンク（Stripe Payment Links）を右側に常時表示します。" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://example.com/" />
  <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=OG" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6faf7; --panel:#ffffff; --muted:#f3f4f6; --line:#e5e7eb;
      --text:#111827; --sub:#6b7280; --brand:#0ea47a; --accent:#10b981; --warn:#f59e0b;
      --pane-width: 440px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    a{color:inherit}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:auto;padding:24px}
    header{border-bottom:1px solid var(--line);background:rgba(255,255,255,0.7);backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:40}
    .topbar{display:flex;align-items:center;gap:10px;padding:12px 24px}
    .brand{display:flex;align-items:center;gap:10px;color:var(--text);text-decoration:none;font-weight:800}
    .brand img{width:32px;height:32px;object-fit:contain}
    .brand .name{font-size:20px;letter-spacing:.2px;line-height:1.2}
    @media (min-width:960px){ .brand img{width:40px;height:40px} .brand .name{font-size:24px} }

    .crumbs{font-size:12px;color:var(--sub)}
    .crumbs a{color:var(--sub);text-decoration:none}

    .h1{font-size:28px;font-weight:700;margin:0 0 8px}
    .sub{color:var(--sub)}

    /* レイアウト */
    .grid{display:grid;gap:16px;grid-template-columns:1fr;align-items:stretch}
    @media (min-width:960px){ .grid{grid-template-columns:var(--pane-width) minmax(0,1fr)} }

    .product-card{
      border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--panel);
      cursor:pointer;width:100%;max-width:var(--pane-width);justify-self:start;grid-column:1/2;
      align-self:stretch;height:100%;
    }
    .product-card .meta{padding:10px 12px}
    .product-card:hover{outline:2px solid var(--brand)}
    .product-card .meta > div:first-child{display:none} /* 小ポップの1行目(商品名)を隠す */

    .btn{display:inline-flex;justify-content:center;align-items:center;gap:8px;border-radius:12px;border:1px solid var(--line);cursor:pointer;text-decoration:none;font-weight:700}
    .btn.primary{
      background:linear-gradient(180deg,var(--brand),#099268);
      color:#fff;border-color:transparent;
      font-size:20px;              /* ← 少し大きく */
      padding:14px 20px;           /* ← 少し大きく */
      min-width:200px;             /* 視認性アップ */
    }
    .btn.secondary{background:var(--muted);color:var(--text);padding:12px 14px;font-weight:600}

    /* 右の購入パネル（中身は中央寄せ） */
    .picker{
      border:5px solid var(--line);border-radius:14px;background:var(--panel);padding:16px;margin:0px 0;
      width:100%;max-width:var(--pane-width);justify-self:start;grid-column:2/3;align-self:stretch;
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;
      scroll-margin-top:96px;
    }
    .picker-head{display:flex;justify-content:center;align-items:center;width:100%}
    .picker .size-choices{display:flex;justify-content:center}
    .buy-slot{margin-top:16px;display:flex;justify-content:center;width:100%}
    .price{margin:8px 0 0;font-weight:700;font-size:22px}

    /* サイズチップを少し大きく */
    .chip{
      padding:12px 16px;           /* ← 少し大きく */
      border:1px solid var(--line);
      border-radius:12px;
      cursor:pointer;background:#f7f7f9;color:var(--text);
      font-size:18px;              /* ← 少し大きく（30kgの文字） */
      font-weight:600;
    }
    .chip[aria-checked="true"], .chip:hover{outline:2px solid var(--brand)}

    .priority{outline:2px solid var(--brand);box-shadow:0 0 0 4px rgba(14,164,122,.08)}

    @media (max-width:959px){ .product-card,.picker{height:auto;align-self:start;grid-column:1/-1} }
  </style>
</head>
<body>
  <header>
    <!-- ロゴ画像のパスは必要に応じて差し替え -->
    <div class="topbar">
      <a class="brand" href="./" aria-label="まるはし ホーム">
        <img src="./assets/maruhashi-logo.png" alt="まるはし ロゴ" width="40" height="40" decoding="async">
        <span class="name">まるはし</span>
      </a>
    </div>
    <div class="container crumbs" aria-label="breadcrumb">
      <a href="./">ホーム</a> / <span aria-current="page">商品一覧</span>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" style="margin:12px 0 8px">商品一覧</h1>

    <section class="grid" id="product-list">
      <!-- 左カラム：商品カード（米のみ表示） -->
      <article class="product-card priority" data-product="komeB">
        <img src="https://via.placeholder.com/600x600.png?text=%E3%81%B5%E3%81%95%E3%81%8A%E3%81%A8%E3%82%81" alt="ふさおとめ">
        <div class="meta"><div>ふさおとめ</div><div class="sub">¥17,000</div></div>
      </article>
      <article class="product-card" data-product="komeA">
        <img src="https://via.placeholder.com/600x600.png?text=%E3%82%B3%E3%82%B7%E3%83%92%E3%82%AB%E3%83%AA" alt="コシヒカリ">
        <div class="meta"><div>コシヒカリ</div><div class="sub">¥17,000</div></div>
      </article>
      <!-- 右カラム：各商品の購入パネル（JSで差し込み） -->
    </section>
  </main>

  <footer class="container">
    <div>© <span id="year"></span> まるはし</div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // 表示名＆サイズ（30kg固定）
    const PRICE_MAP = {
      komeA:{ title:'コシヒカリ', sizes:[{label:'30kg'}] },
      komeB:{ title:'ふさおとめ', sizes:[{label:'30kg'}] }
    };

    // ▼本番の決済リンク（まるはし）
    const PRODUCTION_PAYMENT_LINKS = {
      'komeA:30kg': 'https://buy.stripe.com/7sYcN54qz17LgOParF7Zu01', // コシヒカリ
      'komeB:30kg': 'https://buy.stripe.com/9B6dR99KT6s5fKL9nB7Zu00', // ふさおとめ
    };

    function renderPicker(key){
      const meta = PRICE_MAP[key];
      const sizeChips = meta.sizes.map((s,i)=>`
        <button class="chip size-chip" type="button" role="option"
                aria-checked="${i===0}" data-label="${s.label}">
          ${s.label}
        </button>`).join('');
      return `
        <div class="picker" data-open-for="${key}">
          <div class="picker-head">
            <h2 class="h1" style="font-size:20px;margin:0">購入：${meta.title}</h2>
          </div>
          <div style="margin-top:8px">
            <div class="choices size-choices" role="listbox" aria-label="サイズ">${sizeChips}</div>
          </div>
          <div class="buy-slot" aria-live="polite"></div>
        </div>`;
    }

    // 購入ボタン（Payment Link）を設置
    function mountPaymentLink(picker, productKey, label){
      const mapKey = `${productKey}:${label}`;
      const prodUrl = PRODUCTION_PAYMENT_LINKS[mapKey];
      const slot   = picker.querySelector('.buy-slot');
      if(!slot || !prodUrl) return;
      slot.innerHTML = `<a class="btn primary" href="${prodUrl}" target="_blank" rel="noopener">購入する</a>`;
    }

    // ▼ページ表示時：米2商品の購入パネルを右に常時表示（上段=ふさおとめ）
    const grid  = document.getElementById('product-list');

    // ふさおとめ(komeB)を先頭に
    const cardKomeB = grid.querySelector('.product-card[data-product="komeB"]');
    if (cardKomeB) grid.insertBefore(cardKomeB, grid.firstChild);

    // それぞれのカードの直後にパネルを作成
    const cards = Array.from(grid.querySelectorAll('.product-card[data-product]'));
    cards.forEach(card=>{
      const key = card.dataset.product;
      const meta = PRICE_MAP[key];
      if(!meta || !meta.sizes?.length) return;

      card.insertAdjacentHTML('afterend', renderPicker(key));
      const picker  = card.nextElementSibling;
      const sizeBox = picker.querySelector('.size-choices');

      const initialLabel = meta.sizes[0].label;
      mountPaymentLink(picker, key, initialLabel);

      sizeBox.addEventListener('click',(e)=>{
        const chip = e.target.closest('.size-chip'); if(!chip) return;
        sizeBox.querySelectorAll('.size-chip').forEach(c=>c.setAttribute('aria-checked','false'));
        chip.setAttribute('aria-checked','true');
        mountPaymentLink(picker, key, chip.dataset.label);
      });
    });

    // ふさおとめのパネルも最上段へ（カード直後のピッカーを取得して並べ替え）
    (function promoteKomeB(){
      const card = grid.querySelector('.product-card[data-product="komeB"]');
      if(!card) return;
      const panel = card.nextElementSibling;
      if(panel && panel.classList.contains('picker')){
        grid.insertBefore(panel, grid.children[1]); // 先頭のカードの直後=右列の先頭
        card.classList.add('priority');
        panel.classList.add('priority');
      }
    })();
  </script>
</body>
</html>
