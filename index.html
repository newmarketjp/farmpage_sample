<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å•†å“ä¸€è¦§ | ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</title>
  <meta name="description" content="4å•†å“ã‚’ã‚¯ãƒªãƒƒã‚¯â†’ã‚µã‚¤ã‚ºâ†’æ•°é‡â†’Stripeã§è³¼å…¥ï¼ˆã‚«ãƒ¼ãƒˆç„¡ã—ï¼‰ã€‚" />
  <meta name="robots" content="index,follow" />
  <meta property="og:title" content="å•†å“ä¸€è¦§ | ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å" />
  <meta property="og:description" content="4å•†å“ã‚’ã‚¯ãƒªãƒƒã‚¯â†’ã‚µã‚¤ã‚ºâ†’æ•°é‡â†’Stripeã§è³¼å…¥ï¼ˆã‚«ãƒ¼ãƒˆç„¡ã—ï¼‰ã€‚" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://example.com/" />
  <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=OG" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0c10; --panel:#111218; --muted:#1a1b23; --line:#232432;
      --text:#e6e7ee; --sub:#a4a7b7; --brand:#7c5cff; --accent:#3ddc97; --warn:#ffb86b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    a{color:inherit}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:auto;padding:24px}
    header{border-bottom:1px solid var(--line);background:rgba(255,255,255,0.02);backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:40}
    .topbar{display:flex;align-items:center;gap:16px;padding:12px 24px}
    .brand{font-weight:700;letter-spacing:.2px}
    .crumbs{font-size:12px;color:var(--sub)}
    .crumbs a{color:var(--sub);text-decoration:none}

    .h1{font-size:28px;font-weight:700;margin:0 0 8px}
    .sub{color:var(--sub)}

    .grid{display:grid;gap:16px;grid-template-columns:repeat(2,1fr)}
    @media(min-width:720px){.grid{grid-template-columns:repeat(4,1fr)}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .panel{padding:20px 20px}

    .product-card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--panel);cursor:pointer}
    .product-card .meta{padding:10px 12px}
    .product-card:hover{outline:2px solid var(--brand)}

    .btn{display:inline-flex;justify-content:center;align-items:center;gap:8px;padding:12px 14px;border-radius:12px;border:1px solid var(--line);cursor:pointer;font-weight:600;}
    .btn.primary{background:linear-gradient(180deg,var(--brand),#5d3bff);color:#fff}
    .btn.secondary{background:var(--muted);color:var(--text)}
    .choices{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{padding:10px 14px;border:1px solid var(--line);border-radius:10px;cursor:pointer;background:var(--muted);color:var(--text)}
    .chip[aria-checked="true"],.chip:hover{outline:2px solid var(--brand)}
    .qty{display:inline-flex;border:1px solid var(--line);border-radius:10px;overflow:hidden;margin-top:8px}
    .qty input{width:64px;text-align:center;background:transparent;color:var(--text);border:none}
    .qty button{width:36px;background:var(--muted);color:var(--text);border:none;cursor:pointer}
    .cta{display:flex;gap:12px;margin-top:14px}
    .notice{font-size:12px;color:var(--sub);margin-top:8px}

    footer{border-top:1px solid var(--line);padding:24px;color:var(--sub);margin-top:40px}

    /* å±•é–‹ãƒ‘ãƒãƒ« */
    .picker{border:1px dashed var(--line);border-radius:14px;background:var(--panel);padding:16px;margin:12px 0}
  </style>

  <script src="https://js.stripe.com/v3"></script>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand">ğŸ›ï¸ ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</div>
    </div>
    <div class="container crumbs" aria-label="breadcrumb">
      <a href="./">ãƒ›ãƒ¼ãƒ </a> / <span aria-current="page">å•†å“ä¸€è¦§</span>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" style="margin:12px 0 16px">å•†å“ä¸€è¦§</h1>
    <p class="sub" style="margin:0 0 12px">å•†å“ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚µã‚¤ã‚ºé¸æŠ â†’ æ•°é‡ â†’ Stripeæ±ºæ¸ˆï¼ˆã‚«ãƒ¼ãƒˆç„¡ã—ï¼‰ã€‚</p>

    <!-- 4å•†å“ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ -->
    <section class="grid" id="product-list">
      <article class="product-card" data-product="komeA">
        <img src="https://via.placeholder.com/600x600.png?text=Kome+A" alt="ç±³A">
        <div class="meta"><div>ç±³Aï¼ˆã‚³ã‚·ãƒ’ã‚«ãƒªï¼‰</div><div class="sub">Â¥2,480ã€œ</div></div>
      </article>
      <article class="product-card" data-product="komeB">
        <img src="https://via.placeholder.com/600x600.png?text=Kome+B" alt="ç±³B">
        <div class="meta"><div>ç±³Bï¼ˆã‚ããŸã“ã¾ã¡ï¼‰</div><div class="sub">Â¥2,280ã€œ</div></div>
      </article>
      <article class="product-card" data-product="imoA">
        <img src="https://via.placeholder.com/600x600.png?text=Imo+A" alt="èŠ‹A">
        <div class="meta"><div>èŠ‹Aï¼ˆã•ã¤ã¾ã„ã‚‚ï¼‰</div><div class="sub">Â¥580ã€œ</div></div>
      </article>
      <article class="product-card" data-product="imoB">
        <img src="https://via.placeholder.com/600x600.png?text=Imo+B" alt="èŠ‹B">
        <div class="meta"><div>èŠ‹Bï¼ˆã˜ã‚ƒãŒã„ã‚‚ï¼‰</div><div class="sub">Â¥480ã€œ</div></div>
      </article>
    </section>
  </main>

  <footer class="container">
    <div>Â© <span id="year"></span> ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</div>
  </footer>

  <script>
    // å¹´
    document.getElementById('year').textContent = new Date().getFullYear();

    // Stripe å…¬é–‹éµï¼ˆå·®ã—æ›¿ãˆï¼‰
    const stripe = Stripe('pk_test_CHANGE_ME');

    // å•†å“ â†’ ã‚µã‚¤ã‚º â†’ Price IDï¼ˆå·®ã—æ›¿ãˆï¼‰
    const PRICE_MAP = {
      komeA: { title: 'ç±³Aï¼ˆã‚³ã‚·ãƒ’ã‚«ãƒªï¼‰',
        sizes: [
          { label: '5kg',  priceId: 'price_TEST_komeA_5kg' },
          { label: '10kg', priceId: 'price_TEST_komeA_10kg' }
        ] },
      komeB: { title: 'ç±³Bï¼ˆã‚ããŸã“ã¾ã¡ï¼‰',
        sizes: [
          { label: '5kg',  priceId: 'price_TEST_komeB_5kg' },
          { label: '10kg', priceId: 'price_TEST_komeB_10kg' }
        ] },
      imoA:  { title: 'èŠ‹Aï¼ˆã•ã¤ã¾ã„ã‚‚ï¼‰',
        sizes: [
          { label: '1kg', priceId: 'price_TEST_imoA_1kg' },
          { label: '3kg', priceId: 'price_TEST_imoA_3kg' }
        ] },
      imoB:  { title: 'èŠ‹Bï¼ˆã˜ã‚ƒãŒã„ã‚‚ï¼‰',
        sizes: [
          { label: '1kg', priceId: 'price_TEST_imoB_1kg' },
          { label: '3kg', priceId: 'price_TEST_imoB_3kg' }
        ] }
    };

    // ãƒ‘ãƒãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå•†å“keyã‚’å—ã‘å–ã£ã¦HTMLã‚’è¿”ã™ï¼‰
    function renderPicker(key){
      const meta = PRICE_MAP[key];
      const sizeChips = meta.sizes.map((s,i)=>
        `<button class="chip" type="button" role="option"
                 aria-checked="${i===0}" data-price="${s.priceId}" data-label="${s.label}">
           ${s.label}
         </button>`).join('');
      return `
        <div class="picker" data-open-for="${key}">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
            <h2 class="h1" style="font-size:20px;margin:0">è³¼å…¥ï¼š${meta.title}</h2>
            <button class="btn secondary" id="close-picker">é–‰ã˜ã‚‹</button>
          </div>
          <div style="margin-top:8px">
            <label class="sub">ã‚µã‚¤ã‚ºã‚’é¸æŠ</label>
            <div id="size-choices" class="choices" role="listbox" aria-label="ã‚µã‚¤ã‚º">${sizeChips}</div>
          </div>
          <div style="margin-top:12px">
            <label class="sub">æ•°é‡ã‚’é¸æŠ</label>
            <div class="qty" aria-label="æ•°é‡">
              <button type="button" data-action="dec">âˆ’</button>
              <input type="number" id="qty" value="1" min="1" inputmode="numeric" aria-label="æ•°é‡">
              <button type="button" data-action="inc">ï¼‹</button>
            </div>
          </div>
          <div class="cta">
            <button id="checkout" class="btn primary">Stripeã§è³¼å…¥</button>
          </div>
          <div class="notice">ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰: 4242 4242 4242 4242 / ä»»æ„ã®æœŸé™ãƒ»CVC</div>
        </div>`;
    }

    // å•†å“ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚«ãƒ¼ãƒ‰ç›´ä¸‹ã«è³¼å…¥ãƒ‘ãƒãƒ«ã‚’æŒ¿å…¥ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ä½¿ã‚ãªã„ï¼‰
    document.querySelectorAll('.product-card[data-product]').forEach(card=>{
      card.addEventListener('click', ()=>{
        const key = card.dataset.product;
        const meta = PRICE_MAP[key];
        if(!meta || !meta.sizes || meta.sizes.length===0){
          alert('å•†å“ã¾ãŸã¯ã‚µã‚¤ã‚ºå®šç¾©ãŒã‚ã‚Šã¾ã›ã‚“: ' + key); return;
        }

        // æ—¢å­˜ã®ãƒ‘ãƒãƒ«ã‚’ã™ã¹ã¦å‰Šé™¤ï¼ˆ1ã¤ã ã‘é–‹ãï¼‰
        document.querySelectorAll('.picker').forEach(p=>p.remove());

        // ã‚«ãƒ¼ãƒ‰ç›´å¾Œã«ãƒ‘ãƒãƒ«ã‚’æŒ¿å…¥
        card.insertAdjacentHTML('afterend', renderPicker(key));

        // ã‚¤ãƒ™ãƒ³ãƒˆæŸç¸›
        const picker   = card.nextElementSibling;
        const sizeBox  = picker.querySelector('#size-choices');
        const qtyInput = picker.querySelector('#qty');

        // ã‚µã‚¤ã‚ºé¸æŠ
        sizeBox.addEventListener('click',(e)=>{
          const chip = e.target.closest('.chip'); if(!chip) return;
          sizeBox.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-checked','false'));
          chip.setAttribute('aria-checked','true');
        });

        // æ•°é‡
        picker.querySelector('[data-action="inc"]').onclick = ()=> qtyInput.value = (+qtyInput.value||1)+1;
        picker.querySelector('[data-action="dec"]').onclick = ()=> qtyInput.value = Math.max(1,(+qtyInput.value||1)-1);

        // é–‰ã˜ã‚‹
        picker.querySelector('#close-picker').onclick = ()=> { picker.remove(); };

        // Checkout
        picker.querySelector('#checkout').onclick = async ()=>{
          const chosen = sizeBox.querySelector('.chip[aria-checked="true"]');
          if(!chosen){ alert('ã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
          const priceId = chosen.dataset.price;
          const qty = Math.max(1, +qtyInput.value||1);

          try{
            const res = await fetch('https://YOUR_SERVER/create-checkout-session', { // â†å·®ã—æ›¿ãˆ
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({
                priceId, quantity: qty,
                metadata: { product: key, size: chosen.dataset.label }
              })
            });
            const data = await res.json();
            if(!res.ok) throw new Error(data.error || 'ã‚¨ãƒ©ãƒ¼');
            await stripe.redirectToCheckout({ sessionId: data.id });
          }catch(err){
            alert(err.message || 'æ±ºæ¸ˆé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªè¨­å®šã®å¯èƒ½æ€§ï¼‰');
          }
        };
      });
    });
  </script>
</body>
</html>
