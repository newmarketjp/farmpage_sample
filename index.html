<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã€å•†å“åã€‘| ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</title>
  <meta name="description" content="ã€å•†å“åã€‘ã®å…¬å¼å•†å“ãƒšãƒ¼ã‚¸ã€‚ç‰¹å¾´ãƒ»ä»•æ§˜ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»é…é€/è¿”å“ãƒãƒªã‚·ãƒ¼ãªã©ã€‚" />
  <meta name="robots" content="index,follow" />
  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="ã€å•†å“åã€‘| ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å" />
  <meta property="og:description" content="ã€å•†å“åã€‘ã®å…¬å¼å•†å“ãƒšãƒ¼ã‚¸ã€‚ç‰¹å¾´ãƒ»ä»•æ§˜ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»é…é€/è¿”å“ãƒãƒªã‚·ãƒ¼ãªã©ã€‚" />
  <meta property="og:type" content="product" />
  <meta property="og:url" content="https://example.com/products/slug" />
  <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=Product+OG" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0c10; --panel:#111218; --muted:#1a1b23; --line:#232432;
      --text:#e6e7ee; --sub:#a4a7b7; --brand:#7c5cff; --accent:#3ddc97; --warn:#ffb86b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    a{color:inherit}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:auto;padding:24px}
    header{border-bottom:1px solid var(--line);background:rgba(255,255,255,0.02);backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:40}
    .topbar{display:flex;align-items:center;gap:16px;padding:12px 24px}
    .brand{font-weight:700;letter-spacing:.2px}
    .crumbs{font-size:12px;color:var(--sub)}
    .crumbs a{color:var(--sub);text-decoration:none}
    .grid{display:grid;gap:28px}
    @media(min-width:960px){.grid{grid-template-columns:1.1fr .9fr}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .panel{padding:20px 20px}

    /* Gallery */
    .gallery{display:grid;grid-template-columns:96px 1fr;gap:16px}
    .thumbs{display:flex;flex-direction:column;gap:10px;max-height:520px;overflow:auto}
    .thumb{border:1px solid var(--line);border-radius:10px;overflow:hidden;cursor:pointer;opacity:.8}
    .thumb.active,.thumb:hover{opacity:1;outline:2px solid var(--brand)}
    .stage{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0f1016;display:flex;align-items:center;justify-content:center;min-height:420px}

    /* Product info */
    .h1{font-size:28px;font-weight:700;margin:0 0 8px}
    .sub{color:var(--sub)}
    .price{display:flex;align-items:end;gap:10px;margin:10px 0 16px}
    .price-now{font-size:28px;font-weight:700;color:var(--accent)}
    .price-old{color:var(--sub);text-decoration:line-through}
    .badge{display:inline-flex;align-items:center;gap:6px;background:var(--muted);border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:12px}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}

    .options{display:grid;gap:14px}
    .field label{display:block;font-size:12px;color:var(--sub);margin-bottom:8px}
    .choices{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 12px;border:1px solid var(--line);border-radius:10px;cursor:pointer;background:var(--muted)}
    .chip[aria-checked="true"],.chip:hover{outline:2px solid var(--brand)}
    .qty{display:inline-flex;border:1px solid var(--line);border-radius:10px;overflow:hidden}
    .qty input{width:56px;text-align:center;background:transparent;color:var(--text);border:none}
    .qty button{width:36px;background:var(--muted);color:var(--text);border:none;cursor:pointer}

    .cta{display:flex;gap:12px;margin-top:14px}
    .btn{flex:1;display:inline-flex;justify-content:center;align-items:center;gap:8px;padding:14px 16px;border-radius:12px;border:1px solid var(--line);cursor:pointer;font-weight:600;}
    .btn.primary{background:linear-gradient(180deg,var(--brand),#5d3bff);color:#fff}
    .btn.secondary{background:var(--muted)}
    .notice{font-size:12px;color:var(--sub);margin-top:8px}

    /* Tabs */
    .tabs{margin-top:24px}
    .tab-list{display:flex;gap:8px;border-bottom:1px solid var(--line)}
    .tab-btn{padding:10px 14px;border:1px solid var(--line);border-bottom:none;border-top-left-radius:12px;border-top-right-radius:12px;background:var(--panel);cursor:pointer}
    .tab-btn[aria-selected="true"]{background:var(--muted);font-weight:600}
    .tab-panel{border:1px solid var(--line);border-top:none;border-bottom-left-radius:12px;border-bottom-right-radius:12px;padding:16px;background:var(--panel)}

    /* Accordions */
    details{border:1px solid var(--line);border-radius:12px;overflow:hidden}
    summary{padding:14px 16px;background:var(--muted);cursor:pointer}
    details>div{padding:14px 16px;background:var(--panel)}

    /* Related */
    .rel-grid{display:grid;gap:16px;grid-template-columns:repeat(2,1fr)}
    @media(min-width:720px){.rel-grid{grid-template-columns:repeat(4,1fr)}}
    .rel-card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--panel)}
    .rel-card .meta{padding:10px 12px}
    .rating{display:flex;align-items:center;gap:6px;color:#ffd166}

    footer{border-top:1px solid var(--line);padding:24px;color:var(--sub);margin-top:40px}
  </style>

  <!-- Product structured data (Schema.org) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "ã€å•†å“åã€‘",
    "image": [
      "https://via.placeholder.com/1200x1200.png?text=Main+Image",
      "https://via.placeholder.com/600x600.png?text=Sub+1",
      "https://via.placeholder.com/600x600.png?text=Sub+2"
    ],
    "description": "ã€ã“ã“ã«å•†å“ã®æ¦‚è¦èª¬æ˜ã€‘",
    "sku": "SKU-12345",
    "brand": {
      "@type": "Brand",
      "name": "ã‚ãªãŸã®ãƒ–ãƒ©ãƒ³ãƒ‰"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.6",
      "reviewCount": "128"
    },
    "offers": {
      "@type": "Offer",
      "url": "https://example.com/products/slug",
      "priceCurrency": "JPY",
      "price": "7980",
      "priceValidUntil": "2026-12-31",
      "availability": "https://schema.org/InStock",
      "itemCondition": "https://schema.org/NewCondition",
      "sku": "SKU-12345",
      "seller": {"@type":"Organization","name":"ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å"}
    }
  }
  </script>
</head>
<script src="https://js.stripe.com/v3"></script>
<body>
  <header>
    <div class="topbar">
      <div class="brand">ğŸ›ï¸ ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</div>
    </div>
    <div class="container crumbs" aria-label="breadcrumb">
      <a href="/">ãƒ›ãƒ¼ãƒ </a> / <a href="/collections">ã‚«ãƒ†ã‚´ãƒªãƒ¼</a> / <span aria-current="page">ã€å•†å“åã€‘</span>
    </div>
  </header>

<main class="container">
  <h1 class="h1" style="margin:12px 0 16px">å•†å“ä¸€è¦§</h1>
  <section class="rel-grid">
    <article class="rel-card" data-product="komeA">
      <img src="https://via.placeholder.com/600x600.png?text=Kome+A" alt="ç±³A">
      <div class="meta"><div>ç±³Aï¼ˆã‚³ã‚·ãƒ’ã‚«ãƒªï¼‰</div><div class="sub">Â¥2,480ã€œ</div></div>
    </article>
    <article class="rel-card" data-product="komeB">
      <img src="https://via.placeholder.com/600x600.png?text=Kome+B" alt="ç±³B">
      <div class="meta"><div>ç±³Bï¼ˆãŠç±³ï¼‰</div><div class="sub">Â¥2,280ã€œ</div></div>
    </article>
    <article class="rel-card" data-product="imoA">
      <img src="https://via.placeholder.com/600x600.png?text=Imo+A" alt="èŠ‹A">
      <div class="meta"><div>èŠ‹Aï¼ˆã¹ã«ã¯ã‚‹ã‹ï¼‰</div><div class="sub">Â¥580ã€œ</div></div>
    </article>
    <article class="rel-card" data-product="imoB">
      <img src="https://via.placeholder.com/600x600.png?text=Imo+B" alt="èŠ‹B">
      <div class="meta"><div>èŠ‹Bï¼ˆã˜ã‚ƒãŒã„ã‚‚ï¼‰</div><div class="sub">Â¥480ã€œ</div></div>
    </article>
  </section>
</main>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚µã‚¤ã‚ºâ†’æ•°é‡â†’è³¼å…¥ï¼‰ -->
<div id="buy-modal" hidden
     style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;">
  <div class="card panel" style="width:min(640px,92vw);">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
      <h2 id="modal-title" class="h1" style="font-size:20px;margin:0">è³¼å…¥</h2>
      <button id="close-modal" class="btn secondary" style="flex:0 0 auto;padding:6px 10px">é–‰ã˜ã‚‹</button>
    </div>

    <!-- Step 1: ã‚µã‚¤ã‚º -->
    <div id="step-size" style="margin-top:10px">
      <label class="sub">ã‚µã‚¤ã‚ºã‚’é¸æŠ</label>
      <div id="size-choices" class="choices" role="listbox" aria-label="ã‚µã‚¤ã‚º"></div>
      <button id="next-to-qty" class="btn primary" style="margin-top:12px">æ¬¡ã¸</button>
    </div>

    <!-- Step 2: æ•°é‡ -->
    <div id="step-qty" hidden>
      <label class="sub">æ•°é‡ã‚’é¸æŠ</label>
      <div class="qty" aria-label="æ•°é‡">
        <button type="button" data-action="dec">âˆ’</button>
        <input type="number" id="modal-qty" value="1" min="1" inputmode="numeric" aria-label="æ•°é‡">
        <button type="button" data-action="inc">ï¼‹</button>
      </div>
      <div class="cta">
        <button id="checkout" class="btn primary">Stripeã§è³¼å…¥</button>
        <button id="back-to-size" class="btn secondary">æˆ»ã‚‹</button>
      </div>
      <div class="notice">ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰: 4242 4242 4242 4242 / ä»»æ„ã®æœŸé™ãƒ»CVC</div>
    </div>
  </div>
</div>

  <section class="container" aria-label="é–¢é€£å•†å“">
    <h2 style="font-size:20px;margin:10px 0 14px">é–¢é€£å•†å“</h2>
    <div class="rel-grid">
      <article class="rel-card">
        <img src="https://via.placeholder.com/600x600.png?text=Rel+1" alt="é–¢é€£å•†å“1">
        <div class="meta"><div>é–¢é€£å•†å“1</div><div class="sub">Â¥4,980</div></div>
      </article>
      <article class="rel-card">
        <img src="https://via.placeholder.com/600x600.png?text=Rel+2" alt="é–¢é€£å•†å“2">
        <div class="meta"><div>é–¢é€£å•†å“2</div><div class="sub">Â¥6,480</div></div>
      </article>
      <article class="rel-card">
        <img src="https://via.placeholder.com/600x600.png?text=Rel+3" alt="é–¢é€£å•†å“3">
        <div class="meta"><div>é–¢é€£å•†å“3</div><div class="sub">Â¥3,280</div></div>
      </article>
      <article class="rel-card">
        <img src="https://via.placeholder.com/600x600.png?text=Rel+4" alt="é–¢é€£å•†å“4">
        <div class="meta"><div>é–¢é€£å•†å“4</div><div class="sub">Â¥8,800</div></div>
      </article>
    </div>
  </section>

  <footer class="container">
    <div>Â© <span id="year"></span> ã‚ãªãŸã®ã‚·ãƒ§ãƒƒãƒ—å</div>
  </footer>

  <script>
  // â‘  Stripe å…¬é–‹éµï¼ˆãƒ†ã‚¹ãƒˆï¼‰ã‚’è¨­å®š
  const stripe = Stripe('pk_test_ã‚ãªãŸã®å…¬é–‹å¯èƒ½ã‚­ãƒ¼');

  // â‘¡ å•†å“â†’ã‚µã‚¤ã‚ºâ†’Price ID å¯¾å¿œï¼ˆStripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä½œã£ãŸ price_xxx ã‚’è²¼ã‚‹ï¼‰
  const PRICE_MAP = {
    komeA: {
      title: 'ç±³Aï¼ˆã‚³ã‚·ãƒ’ã‚«ãƒªï¼‰',
      sizes: [
        { label: '5kg',  priceId: 'price_xxx_komeA_5kg' },
        { label: '10kg', priceId: 'price_xxx_komeA_10kg' }
      ]
    },
    komeB: {
      title: 'ç±³Bï¼ˆã‚ããŸã“ã¾ã¡ï¼‰',
      sizes: [
        { label: '5kg',  priceId: 'price_xxx_komeB_5kg' },
        { label: '10kg', priceId: 'price_xxx_komeB_10kg' }
      ]
    },
    imoA: {
      title: 'èŠ‹Aï¼ˆã•ã¤ã¾ã„ã‚‚ï¼‰',
      sizes: [
        { label: '1kg', priceId: 'price_xxx_imoA_1kg' },
        { label: '3kg', priceId: 'price_xxx_imoA_3kg' }
      ]
    },
    imoB: {
      title: 'èŠ‹Bï¼ˆã˜ã‚ƒãŒã„ã‚‚ï¼‰',
      sizes: [
        { label: '1kg', priceId: 'price_xxx_imoB_1kg' },
        { label: '3kg', priceId: 'price_xxx_imoB_3kg' }
      ]
    }
  };

  // â‘¢ ä¸€è¦§â†’ãƒ¢ãƒ¼ãƒ€ãƒ«é·ç§»
  const modal   = document.getElementById('buy-modal');
  const titleEl = document.getElementById('modal-title');
  const sizeBox = document.getElementById('size-choices');
  const stepSize= document.getElementById('step-size');
  const stepQty = document.getElementById('step-qty');
  const qtyInput= document.getElementById('modal-qty');

  let selected = { productKey:null, priceId:null, sizeLabel:null, qty:1 };

  document.querySelectorAll('.rel-card').forEach(card=>{
    card.addEventListener('click', ()=>{
      const key = card.dataset.product;
      const meta = PRICE_MAP[key];
      if(!meta) return alert('æœªå®šç¾©ã®å•†å“ã§ã™');

      selected = { productKey:key, priceId:null, sizeLabel:null, qty:1 };
      titleEl.textContent = `è³¼å…¥ï¼š${meta.title}`;
      sizeBox.innerHTML = meta.sizes.map((s,i)=>
        `<button class="chip" role="option" aria-checked="${i===0}" data-price="${s.priceId}" data-label="${s.label}">${s.label}</button>`
      ).join('');

      modal.hidden = false;
      stepSize.hidden = false; stepQty.hidden = true;
      qtyInput.value = 1;
    });
  });

  document.getElementById('close-modal').onclick = ()=> modal.hidden = true;

  sizeBox.addEventListener('click',(e)=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    sizeBox.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-checked','false'));
    chip.setAttribute('aria-checked','true');
  });

  document.getElementById('next-to-qty').onclick = ()=>{
    const chosen = sizeBox.querySelector('.chip[aria-checked="true"]');
    if(!chosen) return alert('ã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„');
    selected.priceId = chosen.dataset.price;
    selected.sizeLabel = chosen.dataset.label;
    stepSize.hidden = true; stepQty.hidden = false;
  };

  document.getElementById('back-to-size').onclick = ()=>{
    stepQty.hidden = true; stepSize.hidden = false;
  };

  stepQty.querySelector('[data-action="inc"]').onclick = ()=> qtyInput.value = (+qtyInput.value||1)+1;
  stepQty.querySelector('[data-action="dec"]').onclick = ()=> qtyInput.value = Math.max(1,(+qtyInput.value||1)-1);

  // â‘£ Checkout Sessionã‚’ä½œã£ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆâ€»åˆ¥ãƒ›ã‚¹ãƒˆã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ãŒå¿…è¦ï¼‰
  document.getElementById('checkout').onclick = async ()=>{
    if(!selected.priceId) return alert('ã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„');
    selected.qty = Math.max(1, +qtyInput.value||1);

    try{
      const res = await fetch('https://YOUR_SERVER/create-checkout-session', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          priceId: selected.priceId,
          quantity: selected.qty,
          metadata: { product: selected.productKey, size: selected.sizeLabel }
        })
      });
      const data = await res.json();
      if(!res.ok) throw new Error(data.error || 'ã‚¨ãƒ©ãƒ¼');
      await stripe.redirectToCheckout({ sessionId: data.id });
    }catch(err){
      alert(err.message || 'æ±ºæ¸ˆé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };
</script>
</body>
</html>
